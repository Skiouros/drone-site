// Generated by CoffeeScript 1.7.1
(function() {
  var codeAddress, getVideos, markerCluster, markers, openVideo, placeMarker, root, setupMap, setupModals, setupSideBar;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  markers = [];

  markerCluster = null;

  $(document).ready(function() {
    root.map = setupMap('map-canvas');
    $(".search").submit(function(e) {
      e.preventDefault();
      return codeAddress("#address", root.map);
    });
    setupSideBar();
    $.extend(true, $.magnificPopup.defaults, {
      removalDelay: 300,
      mainClass: "my-mfp-zoom-in",
      type: "ajax",
      closeOnContentClick: false,
      fixedContentPos: true
    });
    setupModals();
    return getVideos();
  });

  setupMap = function(id) {
    var mapCanvas, mapOptions;
    mapCanvas = document.getElementById(id);
    mapOptions = {
      center: new google.maps.LatLng(44.8281, -98.5463),
      zoom: 6,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    return new google.maps.Map(mapCanvas, mapOptions);
  };

  codeAddress = function(id, map) {
    var address;
    address = $(id).val();
    root.geocoder = new google.maps.Geocoder();
    return geocoder.geocode({
      address: address
    }, function(results, status) {
      if (status === google.maps.GeocoderStatus.OK) {
        return map.setCenter(results[0].geometry.location);
      } else {
        return console.log("Geocode was not succesful: " + status);
      }
    });
  };

  setupSideBar = function() {
    var switchTab, tab, tabs, _i, _len;
    tabs = ["latest", "editors", "popular", "favourites"];
    switchTab = function() {
      var tab, _i, _j, _len, _len1;
      for (_i = 0, _len = tabs.length; _i < _len; _i++) {
        tab = tabs[_i];
        $(".drone-list." + tab).hide();
      }
      $(".drone-list." + this.id).show();
      for (_j = 0, _len1 = tabs.length; _j < _len1; _j++) {
        tab = tabs[_j];
        $("\#" + tab).attr("class", "");
      }
      return $(this).attr("class", "active");
    };
    for (_i = 0, _len = tabs.length; _i < _len; _i++) {
      tab = tabs[_i];
      $("\#" + tab).click(switchTab);
    }
    return $('#menu-trigger').click(function(e) {
      e.preventDefault();
      return $("body").toggleClass("menu-active");
    });
  };

  setupModals = function() {
    $("#contact").magnificPopup({
      items: {
        src: "/static/pages/contact_us.html"
      },
      type: "ajax"
    });
    $("#about").magnificPopup({
      items: {
        src: "/static/pages/about_us.html"
      },
      type: "ajax"
    });
    $("#add_drone").magnificPopup({
      items: {
        src: "/static/drones/add.html"
      },
      type: "ajax"
    });
    return $.get("/users", function(data) {
      var src;
      src = "/users/profile";
      if (data.Errors) {
        src = "/static/users/login.html";
      }
      return $("#login").magnificPopup({
        items: {
          src: src
        },
        type: "ajax"
      });
    });
  };

  root.getLatLong = function(str) {
    var lat, latlngStr, lng;
    latlngStr = str.replace("(", "").split(",", 2);
    lat = parseFloat(latlngStr[0]);
    lng = parseFloat(latlngStr[1]);
    return new google.maps.LatLng(lat, lng);
  };

  placeMarker = function(video) {
    var marker;
    marker = new google.maps.Marker({
      content: video,
      position: root.getLatLong(video.Position),
      map: root.map
    });
    google.maps.event.addListener(marker, "click", function(marker, i) {
      return openVideo(this.content);
    });
    return markers.push(marker);
  };

  getVideos = function() {
    return $.get("/videos", function(data) {
      var video, _i, _len;
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        video = data[_i];
        placeMarker(video);
      }
      return markerCluster = new MarkerClusterer(root.map, markers);
    });
  };

  openVideo = function(video) {
    console.log("Playing Video " + video.Url);
    window.history.pushState("", "Play Vdieo", "/play/" + video.Id);
    return $.magnificPopup.open({
      removalDelay: 0,
      mainClass: 'my-mfp-zoom-in',
      items: video.Url,
      type: "inline",
      callbacks: {
        close: function() {
          return window.history.pushState("", "Home", "/");
        }
      },
      inline: {
        markup: "<div class=\"mfp-iframe-scaler\">\n    <button title=\"Close (Esc)\" type=\"button\" class=\"mfp-close\">Ã—</button>\n    <iframe src=\"http://www.youtube.com/embed/" + video.Url + "?autoplay=1&amp;rel=0\" class=\"mfp-iframe\" frameborder=\"0\" allowfullscreen=\"\"></iframe>\n    <div class=\"mfp-bottom-bar footer\">\n        <ul class=\"no-style menu social-share float-left social-links-block cf hide-mobile ss-initialized\" data-share-url=\"http://www.travelbydrone.com/play/79\">\n            <li><a target=\"_blank\" class=\"share-facebook facebook\" href=\"#\">Share via Facebook</a>\n            </li>\n            <li><a target=\"_blank\" class=\"share-twitter twitter\" href=\"#\">Share via Twitter</a>\n            </li>\n            <li><a target=\"_blank\" class=\"share-google google\" href=\"#\">Share via Google+</a>\n            </li>\n            <li><a class=\"report action text-center trans\" href=\"/reports/add/79\">Report!</a>\n            </li>\n            <li class=\"mia disabled\"><a class=\"addToFavourite\" href=\"#\">Add To Favourites</a>\n            </li>\n            <li class=\"mia disabled\">\n                <div class=\"rating\" data-average=\"null\" data-id=\"79\" style=\"height: 20px; width: 115px; overflow: hidden; z-index: 1; position: relative;\">\n                    <div class=\"jRatingColor\"></div>\n                    <div class=\"jRatingAverage\" style=\"width: 0px; top: -20px;\"></div>\n                    <div class=\"jStar\" style=\"width: 115px; height: 20px; top: -40px; background: url(http://travelbydrone.com/img/stars.png) repeat-x;\"></div>\n                </div>\n            </li>\n        </ul>\n    </div>\n</div>"
      }
    });
  };

}).call(this);
